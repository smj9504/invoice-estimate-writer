<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Plumber Report</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>{{ css_inline }}</style>
</head>
<body>

<!-- Running headers for PDF (will appear on every page except first) -->
<div class="header-running">
  <div style="display: flex; justify-content: space-between; border-bottom: 1px solid #434040; padding-bottom: 5px; font-family: Arial, sans-serif;">
    <div style="font-size: 10px; line-height: 1.2;">
      <strong>{{ company.name }}</strong><br>
      {{ company.address }}<br>
      {% if company.city_state_zip %}{{ company.city_state_zip }}<br>{% endif %}
      {{ company.phone }}<br>
      {% if company.email %}{{ company.email }}{% endif %}
    </div>
    <div style="font-size: 10px; line-height: 1.2; text-align: right;">
      <strong>Report ID:</strong> {{ report_id }}<br>
      <strong>Report Date:</strong> {{ report_date }}
    </div>
  </div>
</div>

<!-- Visible header for first page only -->
<div class="first-page-header">
  <div style="font-size: 10px; line-height: 1.2;">
    <strong>{{ company.name }}</strong><br>
    {{ company.address }}<br>
    {% if company.city_state_zip %}{{ company.city_state_zip }}<br>{% endif %}
    {{ company.phone }}<br>
    {% if company.email %}{{ company.email }}{% endif %}
  </div>
  <div style="font-size: 10px; line-height: 1.2; text-align: right;">
    <strong>Report ID:</strong> {{ report_id }}<br>
    <strong>Report Date:</strong> {{ report_date }}
  </div>
</div>
<hr style="border: none; border-top: 1px solid #434040; margin: 0;">

<main>
  <div class="two-column">
    <div>
      <h3>Client Information</h3>
      {% if client.name %}
        <p><strong>Client Name</strong><br>{{ client.name }}</p>
      {% endif %}
      {% if client.phone %}
        <p><strong>Phone Number</strong><br>{{ client.phone }}</p>
      {% endif %}
      {% if client.email %}
        <p><strong>Email Address</strong><br>{{ client.email }}</p>
      {% endif %}
      <p><strong>Service Location</strong><br>{{ client.address }}</p>
    </div>
    <div>
      {% if plumber.use_company_info %}
        <h3>Company Information</h3>
        <p><strong>Company Name</strong><br>{{ plumber.company }}</p>
        <p><strong>Contact Number</strong><br>{{ plumber.phone }}</p>
        {% if plumber.address or plumber.city_state_zip %}
          <p><strong>Address</strong><br>
          {% if plumber.address %}{{ plumber.address }}<br>{% endif %}
          {% if plumber.city_state_zip %}{{ plumber.city_state_zip }}{% endif %}</p>
        {% endif %}
      {% else %}
        <h3>Plumber Information</h3>
        {% if plumber.name %}
          <p><strong>Plumber/Representative Name</strong><br>{{ plumber.name }}</p>
        {% endif %}
        <p><strong>Company Name</strong><br>{{ plumber.company }}</p>
        <p><strong>Phone Number</strong><br>{{ plumber.phone }}</p>
        {% if plumber.license %}
          <p><strong>License Number</strong><br>{{ plumber.license }}</p>
        {% endif %}
      {% endif %}
    </div>
  </div>

  <h3>Damage Assessment</h3>
  <table class="damage-assessment">
    <colgroup>
      <col style="width: 20%;">
      <col style="width: 30%;">
      <col style="width: 20%;">
      <col style="width: 30%;">
    </colgroup>
    <tr>
      <th>Date of Incident</th>
      <td>{{ damage.incident_date }}</td>
      <th rowspan="2">Affected Area</th>
      <td rowspan="2">{{ damage.area }}</td>
    </tr>
    <tr>
      <th>Water Intrusion Category</th>
      <td style="white-space: nowrap;">
        <label style="display: inline-block; margin-right: 10px;"><input type="checkbox" {% if damage.category == 'Cat 1' %}checked{% endif %}> Cat 1</label>
        <label style="display: inline-block; margin-right: 10px;"><input type="checkbox" {% if damage.category == 'Cat 2' %}checked{% endif %}> Cat 2</label>
        <label style="display: inline-block;"><input type="checkbox" {% if damage.category == 'Cat 3' %}checked{% endif %}> Cat 3</label>
      </td>
    </tr>
    <tr>
      <th>Cause of Damage</th>
      <td colspan="3">{{ damage.cause }}</td>
    </tr>
    <tr>
      <th>Scope of Damage</th>
      <td colspan="3">{{ damage.scope }}</td>
    </tr>
  </table>

  <h3>Repair Details</h3>
  <table class="repair-details">
    <colgroup>
      <col style="width: 20%;">
      <col style="width: 80%;">
    </colgroup>
    <tr>
      <th>Service Dates</th>
      <td colspan="3">
        {% if repair.start_date == repair.end_date %}
          {{ repair.start_date.strftime("%B %d, %Y") }}
        {% else %}
          {{ repair.start_date.strftime("%B %d, %Y") }} â€“ {{ repair.end_date.strftime("%B %d, %Y") }}
        {% endif %}
      </td>
    </tr>
    <tr><th>Scope of Work Performed</th><td colspan="3">{{ repair.work }}</td></tr>
    <tr><th>Materials Utilized</th><td colspan="3">{{ repair.materials }}</td></tr>
    <tr><th>Equipment Used</th><td colspan="3">{{ repair.equipment }}</td></tr>
    <tr><th>Post-Repair Condition</th><td colspan="3">{{ repair.result }}</td></tr>
  </table>

  {% if invoice["items"] and invoice["items"]|length > 0 %}
  <h3 style="display: flex; justify-content: space-between; align-items: center;">
    <span>Invoice</span>
    <span style="font-weight: normal !important;">Invoice No. {{ invoice.number }}</span>
  </h3>
  
  <table class="invoice-table">
    <colgroup>
      <col style="width: 55%;"> <!-- Item Description -->
      <col style="width: 10%;"> <!-- Qty -->
      <col style="width: 5%;"> <!-- Unit -->
      <col style="width: 15%;"> <!-- Unit Price -->
      <col style="width: 15%;"> <!-- Line Total -->
    </colgroup>
    <thead>
      <tr>
        <th class="left">Item Description</th>
        <th class="right">Qty</th>
        <th class="left">Unit</th>
        <th class="right">Unit Price</th>
        <th class="right">Line Total</th>
      </tr>
    </thead>
    <tbody>
      {% for item in invoice["items"] %}
      {% if item.description and item.qty and item.unit_price %}
      <tr>
        <td class="left">{{ item.description }}</td>
        <td class="right">{{ item.qty }}</td>
        <td class="left">{{ item.unit }}</td>
        <td class="right">${{ "{:,.2f}".format(item.unit_price | float) }}</td>
        <td class="right">${{ "{:,.2f}".format(item.line_total | float) }}</td>
      </tr>
      {% endif %}
      {% endfor %}
    </tbody>
  </table>
  
  <hr>
  
  <table class="invoice-summary">
    <tr>
      <td style="text-align: right;"><strong>Total Charges:</strong> <span style="font-size: 14px;">{{ invoice.subtotal }}</span></td>
    </tr>
    {% for payment in invoice["payments"] %}
      {% if payment.amount_display %}
      <tr>
        <td style="text-align: right;">({{ payment.date }}) Amount Paid: <span style="font-size: 13px;">-{{ payment.amount_display }}</span></td>
      </tr>
      {% endif %}
    {% endfor %}
    <tr>
      <td style="text-align: right;"><strong>Total Due:</strong> <span style="font-size: 14px; font-weight: bold;">{{ invoice.total_due }}</span></td>
    </tr>
  </table>
  {% endif %}
  
  {% if notes %}
  <h3>Notes & Recommendations</h3>
  <p>{{ notes }}</p>
  {% endif %}  

</body>
</html>
